<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://code.jquery.com/jquery-3.7.1.js" integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=" crossorigin="anonymous"></script>
<link href="/css/topbar.css" rel="stylesheet" type="text/css">
<title>Pricing</title>
<style>
* {
	margin: 0;
	padding: 0;
	box-sizing: border-box;
}

body {
	font-family: Arial, sans-serif;
	background-color: #191820;
	color: white;
	line-height: 1.5;
}

/* Hero Section */
.hero {
	text-align: center;
	padding: 2rem 1rem;
}

.hero h1 {
	font-size: 2rem;
	margin-bottom: 1rem;
}

.hero p {
	color: #9ca3af;
	margin-bottom: 2rem;
}

/* Categories */
.categories {
	display: flex;
	justify-content: center;
	gap: 1.5rem;
	margin-bottom: 2rem;
	flex-wrap: wrap;
}

.category {
	display: flex;
	flex-direction: column;
	align-items: center;
	color: #9ca3af;
	background: none;
	border: none;
	padding: 0.5rem;
	cursor: default;
}

.category span {
	margin-top: 0.5rem;
}

.pricing {
	display: grid;
	grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
	gap: 1.5rem;
	max-width: 1200px;
	margin: 0 auto;
	padding: 0 1rem;
}

.card {
	background-color: #1f1f2c;
	border: 2px solid rgba(129, 55, 233, 0.2);
	border-radius: 0.5rem;
	padding: 1.5rem;
	height: 370px;
	position: relative;
}

.card h3 {
	font-size: 1.25rem;
	margin-bottom: 0.5rem;
}

.current-plan {
	background-color: #2a2936;
	border: 2px solid #8137e9;
	animation: border-animation 2s ease-in-out infinite;
}

.current-plan::after {
	content: "사용 중";
	position: absolute;
	top: 0.5rem;
	right: 0.5rem;
	background-color: #5e37e9;
	color: white;
	padding: 0.25rem 0.5rem;
	border-radius: 0.25rem;
	font-size: 0.75rem;
}

@keyframes border-animation {
  0% {
    border-color: #8137e9;
  }
  50% {
    border-color: #C07AEF;
  }
  100% {
    border-color: #8137e9;
  }
}

.price {
	font-size: 1.5rem;
	font-weight: bold;
	margin-bottom: 1.5rem;
}

.price span {
	font-size: 0.875rem;
	color: #9ca3af;
}

.features {
	list-style: none;
	color: #9ca3af;
	margin-bottom: 1.5rem;
}

.features li {
	display: flex;
	align-items: center;
	margin-bottom: 0.5rem;
}

.features li::before {
	content: "•";
	margin-right: 0.5rem;
}

.start-button {
	width: 100%;
	background-color: #8137e9;
	color: white;
	border: none;
	padding: 0.75rem;
	border-radius: 0.25rem;
	cursor: pointer;
	font-weight: 500;
	position: absolute;
	bottom: 20px;
	left: 50%;
	transform: translateX(-50%);
	width: calc(100% - 40px);
}

.start-button:hover {
	background-color: #6c2bd9;
}

.footer-text {
	text-align: center;
	color: #9ca3af;
	margin-top: 4.5rem;
	padding: 0 1rem;
}

@media ( max-width : 768px) {
	.hero h1 {
		font-size: 1.5rem;
	}
	.categories {
		gap: 1rem;
	}
}
</style>
</head>
<div th:replace="~{views/common/topbar :: topbar}"></div>
<body>
	<div class="hero">
		<h1>
			작업을 위한 무제한의 컨텐츠들을<br> 한곳에서 만나보세요.
		</h1>
		<p>글로벌 아티스트를 구독하고, 그들의 고품질 자산과 템플릿을 마음껏 활용해 보세요!</p>

		<div class="categories">
			<button class="category">
				<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                </svg>
				<span>Video</span>
			</button>
			<button class="category">
				<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                    <circle cx="8.5" cy="8.5" r="1.5"></circle>
                    <polyline points="21 15 16 10 5 21"></polyline>
                </svg>
				<span>Graphics</span>
			</button>
			<button class="category">
				<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M9 18V5l12-2v13"></path>
                    <circle cx="6" cy="18" r="3"></circle>
                    <circle cx="18" cy="16" r="3"></circle>
                </svg>
				<span>Audio</span>
			</button>
			<button class="category">
				<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"></circle>
                </svg>
				<span>Photos</span>
			</button>
			<button class="category">
				<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="4 7 4 4 20 4 20 7"></polyline>
                    <line x1="9" y1="20" x2="15" y2="20"></line>
                    <line x1="12" y1="4" x2="12" y2="20"></line>
                </svg>
				<span>Fonts</span>
			</button>
			<button class="category">
				<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        			<path d="M12 2L12 22M17 12L7 12M22 12L2 12"></path>
				</svg>
				<span>More</span>
			</button>
		</div>

		<div class="pricing">
			<!-- All Rounder 카드 -->
			<div th:class="${loginUser != null and loginUser.userPlan == 'All Rounder'} ? 'card current-plan' : 'card'">
				<h3>All Rounder</h3>
				<div class="price">
					26,000<span>/30</span>
				</div>
				<ul class="features">
					<li>All Content for Free on VPLAY</li>
					<li>FREE Stock Video</li>
					<li>FREE Graphic Templates & Photo</li>
					<li>FREE Sound Effects</li>
					<li>FREE Fonts</li>
				</ul>
				<button class="start-button" th:if="${loginUser == null or loginUser.userPlan != 'All Rounder'}">Start now</button>
			</div>
			<input type="text" id="userEmail" hidden th:value="${loginUser != null ? loginUser.userEmail:''}"/>
			<!-- Graphic Pro 카드 -->
			<div th:class="${loginUser != null and loginUser.userPlan == 'Graphic Pro'} ? 'card current-plan' : 'card'">
				<h3>Graphic Pro</h3>
				<div class="price">
					12,500<span>/30</span>
				</div>
				<ul class="features">
					<li>FREE Graphic Templates & Photo</li>
					<li>FREE Sound Effects</li>
					<li>FREE Fonts</li>
				</ul>
				<button class="start-button" th:if="${loginUser == null or loginUser.userPlan != 'Graphic Pro'}">Start now</button>
			</div>

			<!-- Frame Pro 카드 -->
			<div th:class="${loginUser != null and loginUser.userPlan == 'Frame Pro'} ? 'card current-plan' : 'card'">
				<h3>Frame Pro</h3>
				<div class="price">
					15,000<span>/30</span>
				</div>
				<ul class="features">
					<li>FREE Stock Video</li>
					<li>FREE Sound Effects</li>
					<li>FREE Fonts</li>
				</ul>
				<button class="start-button" th:if="${loginUser == null or loginUser.userPlan != 'Frame Pro'}">Start now</button>
			</div>
		</div>
		<p class="footer-text">가격은 한국 원(₩) 기준이며, 부가세가 포함된 가격입니다. VPLAY 의 사용자 약관이 적용됩니다.</p>
	</div>
	<script src="https://cdn.iamport.kr/v1/iamport.js"></script>
	<script>
		IMP.init("imp64726784");
		const priceBtn = document.querySelectorAll('.start-button');
		const userEmail = document.getElementById('userEmail').value;
		priceBtn.forEach(btn=>{
			btn.addEventListener('click',()=>{
				const card = btn.closest('.card');
				const price = card.querySelector('.price').textContent;
				const priceName = card.querySelector('h3').textContent.trim();
// 				console.log(price.innerHTML);
				console.log(userEmail);
				const realPrice = price.split('/')[0].trim();
// 				console.log(realPrice);
				
				const realPriceSlice = realPrice.split(',');
				const realRealPrice = realPriceSlice[0].trim() + realPriceSlice[1].trim();
// 				console.log(realRealPrice);
				
				IMP.request_pay({
					pg: "html5_inicis.INIpayTest", // 사용할 PG사
					pay_method: "card", // 결제 방식
					merchant_uid: "order_" + new Date().getTime(), // 주문 고유 번호
					amount: realRealPrice, // 결제 금액
					name:priceName,
					buyer_email:userEmail
				},function(rsp){
					if(rsp.success){
						alert("결제가 완료되었습니다. 결제 금액 ->"+ parseInt(rsp.paid_amount,10));
						
						fetch('/payment/success',{
							method:'POST',
							headers:{
								"Content-Type":"application/json"
							},
							body:JSON.stringify({
								paymentId:rsp.imp_uid,
								amount : rsp.paid_amount
							})
						}).then(response=>{
							if(response.ok){
								alert("결제 성공");
								console.log(response);
								location.reload();
							}else{
								alert("결제 실패");
							}
						});
					}else{
						alert(rsp.error_msg);
					}
				});
			});
		});
	</script>
</body>
</html>