<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÌÅ¨Î¶¨ÏóêÏù¥ÌÑ∞ ÌéòÏù¥ÏßÄ</title>
    <link href="/css/topbar.css" rel="stylesheet">
	<link href="/css/user/myPage.css/" rel="stylesheet" type="text/css">
    <style>
        body {
            background-color: #1e1d24 !important;
            color: white;
            font-family: 'Pretendard', sans-serif;
            margin: 0;
            padding: 0;
        }

        .main-content {
            display: flex;
            padding: 40px;
            gap: 40px;
        }

        .creator-profile {
            background-color: #2b2a33;
            padding: 24px;
            border-radius: 12px;
            width: 280px;
            text-align: center;
			display: flex;
			flex-direction: column;
			align-content: center;
			align-items: center;
        }

        .creator-profile img {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background-color: #444;
            margin-bottom: 16px;
        }

        .creator-profile h2 {
            font-size: 20px;
            margin: 0;
        }

        .creator-profile p {
            font-size: 14px;
            color: #aaa;
            margin: 8px 0 16px;
        }

        .creator-profile button {
			width: 100%;
			border-radius: 6px;
			cursor: pointer;
			border: 1px solid #5e37e9;
			color: #fff;
			background: linear-gradient(45deg, #161840, #272A65);
			box-sizing: border-box;
			padding : 14px 16px;
        }

        .project-section {
            flex: 1;
        }

        .project-section h2 {
            font-size: 20px;
            margin-bottom: 20px;
        }

		p{
			display: flex;
			align-items: center;
		}

		p svg {
			margin-right: 4px;
		}

    </style>
</head>
<body>
    <div th:replace="~{views/common/topbar :: topbar}"></div>
    <div class="main-content">
        <div class="creator-profile">
            <img th:src="${createrUser.userProfile}" alt="ÌîÑÎ°úÌïÑ Ïù¥ÎØ∏ÏßÄ">
            <h2 th:text="${createrUser.userNickname}">ÌÅ¨Î¶¨ÏóêÏù¥ÌÑ∞ Ïù¥Î¶Ñ</h2>
            <p th:text="${createrUser.userComment}">ÏÜåÍ∞ú Î¨∏Íµ¨Í∞Ä Îì§Ïñ¥Í∞ëÎãàÎã§</p>
            <p><svg width="14" height="12" viewBox="0 0 14 12" fill="none" xmlns="http://www.w3.org/2000/svg">
				<path d="M4.20042 5.60056C4.9431 5.60056 5.65536 5.30553 6.18052 4.78038C6.70567 4.25522 7.0007 3.54296 7.0007 2.80028C7.0007 2.0576 6.70567 1.34534 6.18052 0.820183C5.65536 0.295029 4.9431 0 4.20042 0C3.45774 0 2.74548 0.295029 2.22032 0.820183C1.69517 1.34534 1.40014 2.0576 1.40014 2.80028C1.40014 3.54296 1.69517 4.25522 2.22032 4.78038C2.74548 5.30553 3.45774 5.60056 4.20042 5.60056ZM10.501 5.60056C11.0581 5.60056 11.5923 5.37929 11.9861 4.98542C12.38 4.59156 12.6013 4.05736 12.6013 3.50035C12.6013 2.94334 12.38 2.40914 11.9861 2.01528C11.5923 1.62141 11.0581 1.40014 10.501 1.40014C9.94404 1.40014 9.40984 1.62141 9.01598 2.01528C8.62211 2.40914 8.40084 2.94334 8.40084 3.50035C8.40084 4.05736 8.62211 4.59156 9.01598 4.98542C9.40984 5.37929 9.94404 5.60056 10.501 5.60056ZM1.75017 7.0007C0.784078 7.0007 0 7.78478 0 8.75088C0 8.75088 0 11.9012 4.20042 11.9012C7.52995 11.9012 8.22022 9.92139 8.36304 9.10091C8.40084 8.88669 8.40084 8.75088 8.40084 8.75088C8.40084 7.78478 7.61676 7.0007 6.65067 7.0007H1.75017ZM9.79538 9.24092C9.79258 9.29693 9.78698 9.3632 9.77858 9.43974C9.70132 10.017 9.50076 10.571 9.19052 11.0639C9.56156 11.1493 9.9942 11.2011 10.4997 11.2011C14 11.2011 14 8.75088 14 8.75088C14 7.78478 13.2159 7.0007 12.2498 7.0007H9.26893C9.60496 7.50195 9.79958 8.10261 9.79958 8.75088V9.10091L9.79538 9.24092Z" fill="#6F757D"/>
				</svg>
				  [[${subscriberCount}]]
            </p>
			<button id="subscribeBtn" th:text="${isSubscribed == 1 ? 'Íµ¨ÎèÖ Ï§ë' : 'Íµ¨ÎèÖÌïòÍ∏∞'}"></button>
            <input type="hidden" id="createrNo" th:value="${createrNo}">
        </div>

        <div class="project-section">
            <h2>Ï†ÑÏ≤¥ ÏûëÏóÖÎ¨º</h2>
            <div class="grid">
					<div class="grid-item" th:each="r : ${list}">
						<input type="hidden" th:value="${r.contentNo}">
						<input type="hidden" th:value="${r.menuNo}">
						<div class="item-thumbnail">
							<th:block th:if="${r.menuNo == 1 || r.menuNo == 5}">
		                    <video id="item-preview" muted loop>
			                	<source type="video/mp4">
			                </video>
			                </th:block>
			                <th:block th:if="${r.menuNo == 4 || r.menuNo == 6 || r.menuNo == 7 || r.menuNo == 2}">
			               		 <img id="item-preview">
			                </th:block>
			                <th:block th:if="${r.menuNo == 3}">
			                	<img id="item-preview" src="/img/sound-effects.png">
			                </th:block>
						</div>

						<!-- Ïª®ÌÖêÏ∏† -->
						<div class="item-content">
							<span class="item-title" th:text="${r.contentTitle}"></span> <input type="hidden" th:value="${r.menuName}">
							<div class="item-actions">
								<span>üëÅÔ∏è [[${r.views}]]</span> <span>‚ù§Ô∏è [[${r.likeCount}]]</span>
							</div>
						</div>
					</div>
				</div>
        </div>
    </div>

	<script type="text/javascript" th:inline="javascript">
		const button = document.getElementById("subscribeBtn");
		const createrNo = document.getElementById('createrNo').value;
		const loginUser = /*[[${session.loginUser}]]*/ null;

		if (button) {
			button.addEventListener("click", () => {
				if (!loginUser) {
					alert('Î°úÍ∑∏Ïù∏ ÌõÑ Ïù¥Ïö©Ìï¥Ï£ºÏÑ∏Ïöî.');
					return;
				}
				const isCancel = button.innerText === "Íµ¨ÎèÖ Ï§ë";

				fetch("/users/post/updateSubscribe", {
					method: "POST",
					headers: { 'content-type': 'application/json; charset=UTF-8' },
					body: JSON.stringify({
						createrNo: parseInt(createrNo),
						isCancel: isCancel
					})
				})
						.then(response => response.json())
						.then(data => {
							if (data === 1) {
								button.innerText = isCancel ? "Íµ¨ÎèÖÌïòÍ∏∞" : "Íµ¨ÎèÖ Ï§ë";
							}
						});
			});
		}

		window.onload = () => {
			thumbnailPlay();
			clickDetail();
		}

		function thumbnailPlay() {
			const gridItems = document.querySelectorAll('.grid-item');

			gridItems.forEach((item) => {
				const thumbnailContainer = item.querySelector('.item-thumbnail');
				const contentNo = item.querySelector('input[type=hidden]').value;
				const menuNo = item.querySelector('input[type=hidden]:nth-of-type(2)').value;

				if (!thumbnailContainer || !contentNo || !menuNo) return;

				fetch("/board/select-thumbnail/" + contentNo)
						.then(response => {
							if (!response.ok) throw new Error('Network response was not ok');
							return response.json();
						})
						.then(data => {
							if (!data || !data.thumbnail) {
								return;
							}

							thumbnailContainer.innerHTML = ''; // Í∏∞Ï°¥ ÎÇ¥Ïö© ÎπÑÏõÄ

							if (menuNo == 1 || menuNo == 5) {
								const video = document.createElement('video');
								video.id = "item-preview";
								video.muted = true;
								video.loop = true;
								video.src = data.thumbnail;
								thumbnailContainer.appendChild(video);

								item.addEventListener('mouseenter', () => video.play().catch(e => {}));
								item.addEventListener('mouseleave', () => {
									video.pause();
									video.currentTime = 0;
								});
							} else if (menuNo == 4 || menuNo == 6 || menuNo == 7 || menuNo == 2) {
								const img = document.createElement('img');
								img.id = "item-preview";
								img.src = data.thumbnail;
								thumbnailContainer.appendChild(img);
							} else { // menuNo == 3 (ÏùåÏïÖ)
								const img = document.createElement('img');
								img.id = "item-preview";
								img.src = "/img/sound-effects.png";
								thumbnailContainer.appendChild(img);
							}
						})
						.catch(err => console.error("Ïç∏ÎÑ§Ïùº Î°úÎî© fetch ÏóêÎü¨:", err));
			});
		}

		function clickDetail() {
			const list = document.querySelectorAll(".grid-item");

			[...list].map((content, index, array) => {
				content.addEventListener('click', function(event) {
					const contentNo = this.children[0].value;
					const menuNo = this.children[1].value;
					let menuName = "";
					switch(menuNo) {
						case "1": menuName = "video-templates"; break;
						case "2": menuName = "music"; break;
						case "3": menuName = "sound-effects"; break;
						case "4": menuName = "graphic-templates"; break;
						case "5": menuName = "stock-video"; break;
						case "6": menuName = "photo"; break;
						case "7": menuName = "font"; break;
						default: menuName = "unknown";
					}
					location.href = "/board/" + menuName + "/" + contentNo;
					event.stopPropagation();
				});
			});
		}
	</script>
</body>
</html>
	</script>
</body>
</html>
